<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Response Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
     <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        .status-alert-red { background-color: #ef4444 !important; animation: pulse 1s infinite; color: white; }
        .status-normal-green { background-color: #10b981 !important; color: white; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        #map { height: 500px; width: 100%; border-radius: 12px; margin-top: 10px; }
    </style>
</head>
<body>
<div id="setupPage" class="login-container">
    <div class="login-box">
        <h1>üè´ School Setup</h1>
        <p>Configure your emergency response system</p>
        <form id="setupForm">
            <div class="form-group">
                <label>School Name</label>
                <input type="text" id="setupSchoolName" placeholder="Enter school name" required>
            </div>
            <div class="form-group">
                <label>Campus Latitude</label>
                <input type="number" id="setupLat" step="0.000001" placeholder="e.g., 7.0731" required>
            </div>
            <div class="form-group">
                <label>Campus Longitude</label>
                <input type="number" id="setupLng" step="0.000001" placeholder="e.g., 125.6128" required>
            </div>
            <div class="form-group">
                <label>Map Zoom Level (14-18)</label>
                <input type="number" id="setupZoom" min="14" max="18" value="16" required>
            </div>
            <button type="submit" class="btn btn-primary">Continue to Registration</button>
        </form>
        <p style="margin-top: 20px; font-size: 13px; color: #6b7280;">
            üí° Tip: Use <a href="https://www.google.com/maps" target="_blank" style="color: #667eea;">Google Maps</a> to find coordinates
        </p>
    </div>
</div>


<div id="registerPage" class="login-container hidden">
    <div class="login-box">
        <h1>üë§ Create Admin Account</h1>
        <p>Register your administrator credentials</p>
        <form id="registerForm">
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="regFullName" placeholder="Enter full name" required>
            </div>
            <div class="form-group">
                <label>Email Address</label>
                <input type="email" id="regEmail" placeholder="admin@school.edu" required>
            </div>
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="regUsername" placeholder="Create username" required minlength="4">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="regPassword" placeholder="Create strong password" required minlength="6">
                <small style="color: #6b7280;">Minimum 6 characters</small>
            </div>
            <div class="form-group">
                <label>Confirm Password</label>
                <input type="password" id="regConfirmPassword" placeholder="Re-enter password" required>
            </div>
            <div class="form-group">
                <label>Role</label>
                <select id="regRole" required>
                    <option value="admin">Administrator</option>
                    <option value="teacher">Teacher</option>
                    <option value="rescue">Rescue Personnel</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Create Account</button>
        </form>
        <p style="margin-top: 15px; text-align: center; font-size: 14px;">
            <a href="#" id="gotoLoginLink" style="color: #667eea;">Already have an account? Login</a>
        </p>
    </div>
</div>


<div id="loginPage" class="login-container hidden">
    <div class="login-box">
        <h1>üö® Emergency Response</h1>
        <p>School Safety Monitoring Dashboard</p>
        <form id="loginForm">
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="username" placeholder="Enter username" required>
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="password" placeholder="Enter password" required>
            </div>
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                    <input type="checkbox" id="rememberMe">
                    Remember me
                </label>
            </div>
            <button type="submit" class="btn btn-primary">Login</button>
            <div id="loginError" class="error-message hidden"></div>
        </form>
        <p style="margin-top: 15px; text-align: center; font-size: 14px;">
            <a href="#" id="gotoRegisterLink" style="color: #667eea;">Create new account</a>
        </p>
    </div>
</div>

<div id="dashboardContainer" class="dashboard-container hidden">

    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>üö® <span id="schoolNameDisplay">Emergency Hub</span></h2>
        </div>
        <div class="user-info">
            <h3 id="userDisplayName">User</h3>
            <p id="userDisplayRole">Role</p>
            <p id="userDisplayEmail" style="font-size: 11px; margin-top: 4px;"></p>
        </div>
        <nav>
            <div class="nav-item active" data-page="attendance">üìã Attendance</div>
            <div class="nav-item" data-page="dashboard">üìä Live Dashboard</div>
            <div class="nav-item" data-page="students">üë• Students</div>
            <div class="nav-item" data-page="devices">üì° Devices (RFID/GPS)</div>
            <div class="nav-item" data-page="reports">üìÑ Reports</div>
            <div class="nav-item" data-page="history">üìú Event History</div>
            <div class="nav-item" data-page="settings">‚öôÔ∏è Settings</div>
        </nav>
    </aside>

    <main class="main-content">
        <header class="top-bar">
            <div class="top-bar-left">
                <h1 id="pageTitle">Attendance Management</h1>
                <div class="connection-status online" id="connectionStatus">
                    <span class="status-dot online"></span>
                    <span>Online</span>
                </div>
            </div>
            <div class="top-bar-actions">
                <div class="update-info">
                    <small>Last Update</small>
                    <div id="lastUpdateTime">--:--:--</div>
                </div>
                <button class="icon-btn" id="notificationsBtn" title="Notifications">
                    üîî
                    <span class="badge" id="notificationBadge">0</span>
                </button>
                <button class="icon-btn" id="audioToggle" title="Audio alerts">üîä</button>
                <button class="icon-btn" id="settingsBtn" title="Settings">‚öôÔ∏è</button>
                <button class="icon-btn" id="logoutBtn" title="Logout">üö™</button>
            </div>
        </header>
   <div id="dashboardPage" class="content-section" style="display: none; padding: 20px;">
    
    <div id="motionStatus" class="status-normal-green" style="padding: 15px; margin-bottom: 20px; border-radius: 12px; text-align: center; font-weight: bold; font-size: 1.2rem;">
        üõ°Ô∏è SYSTEM SECURE: NO MOTION DETECTED
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
        <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center; border-left: 5px solid #10b981;">
            <h3 style="color: #6b7280; font-size: 0.9rem; margin-bottom: 5px;">SAFE STUDENTS</h3>
            <div id="safeCount" style="font-size: 2rem; font-weight: bold; color: #111827;">0</div>
        </div>
        <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center; border-left: 5px solid #ef4444;">
            <h3 style="color: #6b7280; font-size: 0.9rem; margin-bottom: 5px;">TRAPPED / SOS</h3>
            <div id="trappedCount" style="font-size: 2rem; font-weight: bold; color: #111827;">0</div>
        </div>
        <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center; border-left: 5px solid #3b82f6;">
            <h3 style="color: #6b7280; font-size: 0.9rem; margin-bottom: 5px;">ACTIVE DEVICES</h3>
            <div id="devicesActive" style="font-size: 2rem; font-weight: bold; color: #111827;">0</div>
        </div>
    </div>

    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
        <h3 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">üìç Real-Time Campus Map</h3>
        <div id="map" style="height: 450px; width: 100%; border-radius: 10px; border: 1px solid #e5e7eb;"></div>
    </div>
</div>
        <div id="attendancePage" class="content">
            <div class="upload-card">
                <h2>Upload Daily Attendance</h2>
                <p style="color: #6b7280; margin-bottom: 20px;">Upload CSV file or manually add students</p>
                
                <div class="upload-area" id="uploadArea">
                    <div style="font-size: 48px; margin-bottom: 10px;">üìÅ</div>
                    <h3>Click to upload CSV file</h3>
                    <p style="color: #6b7280;">Format: ID, Name, Class, Section, Contact, RFID</p>
                </div>
                <input type="file" id="csvFileInput" accept=".csv" class="hidden">
                
                <div style="margin: 20px 0; text-align: center;">
                    <button class="btn" style="background: #667eea; color: white;" id="manualAddBtn">‚ûï Add Student Manually</button>
                    <button class="btn" style="background: #10b981; color: white;" id="generateSampleBtn">üé≤ Generate Sample Data</button>
                </div>
                
                <div id="attendanceSummary" class="hidden" style="margin-top: 30px;">
                    <h3>Attendance Summary</h3>
                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>TOTAL STUDENTS</h4>
                            <div class="number" id="totalStudents">0</div>
                        </div>
                        <div class="summary-card">
                            <h4>WITH RFID</h4>
                            <div class="number" id="totalWithRFID">0</div>
                        </div>
                        <div class="summary-card">
                            <h4>WITH GPS</h4>
                            <div class="number" id="totalWithGPS">0</div>
                        </div>
                        <div class="summary-card">
                            <h4>CLASSES</h4>
                            <div class="number" id="totalClasses">0</div>
                        </div>
                    </div>
                    <button class="btn btn-activate" id="activateCalamityBtn">
                        ‚ö†Ô∏è ACTIVATE CALAMITY MODE
                    </button>
                </div>
            </div>
        </div>

        <div id="dashboardPage" class="content hidden">
            <div class="stats-row">
                <div class="stat-card safe">
                    <div class="stat-info">
                        <h3>SAFE</h3>
                        <div class="count" id="safeCount">0</div>
                        <p class="stat-detail">Students in safe zones</p>
                    </div>
                    <div class="stat-icon">‚úÖ</div>
                </div>
                <div class="stat-card trapped">
                    <div class="stat-info">
                        <h3>TRAPPED</h3>
                        <div class="count" id="trappedCount">0</div>
                        <p class="stat-detail">Needs immediate rescue</p>
                    </div>
                    <div class="stat-icon">üÜò</div>
                </div>
                <div class="stat-card missing">
                    <div class="stat-info">
                        <h3>MISSING</h3>
                        <div class="count" id="missingCount">0</div>
                        <p class="stat-detail">Location unknown</p>
                    </div>
                    <div class="stat-icon">‚ùì</div>
                </div>
                <div class="stat-card info">
                    <div class="stat-info">
                        <h3>DEVICES ACTIVE</h3>
                        <div class="count" id="devicesActive">0</div>
                        <p class="stat-detail">Online tracking devices</p>
                    </div>
                    <div class="stat-icon">üì°</div>
                </div>
            </div>

            <div id="settingsPage" class="hidden">
    <h2>‚öôÔ∏è Settings</h2>
    <!-- 1. User Account / Authentication -->
    <section>
        <h3>User Account / Authentication</h3>
        <!-- Sign Up / Login -->
        <button id="btnAddUser">Add New User</button>
        <button id="btnManageUsers">Manage Users</button>
        <div id="userList" style="margin-top: 10px;"></div>
        <!-- Optional: Password Reset -->
        <button id="btnResetPassword">Reset Password</button>
    </section>
    <!-- 2. Device Control -->
    <section>
        <h3>Device Control</h3>
        <div id="deviceList">
            <!-- List of devices with On/Off buttons populated by JS -->
        </div>
    </section>
    <!-- 3. Dashboard Display -->
    <section>
        <h3>Dashboard Display</h3>
        <label><input type="radio" name="dashboardView" value="chart"> Chart</label>
        <label><input type="radio" name="dashboardView" value="numbers"> Numbers</label>
    </section>
    <!-- 4. Alert Settings -->
    <section>
        <h3>Alert Settings</h3>
        <label>High Temperature Threshold: 
            <input type="number" id="highTempLimit" value="50"> ¬∞C
        </label>
        <button id="btnSaveAlertSettings">Save Alert Settings</button>
    </section>
    <!-- 5. User Profile -->
    <section>
        <h3>User Profile</h3>
        <input type="text" id="profileName" placeholder="Name">
        <input type="email" id="profileEmail" placeholder="Email">
        <input type="password" id="profilePassword" placeholder="New Password">
        <button id="btnUpdateProfile">Update Profile</button>
    </section>
    <!-- 6. Theme -->
    <section>
        <h3>Theme</h3>
        <button id="btnLightMode">Light Mode</button>
        <button id="btnDarkMode">Dark Mode</button>
    </section>
    <!-- Back to Dashboard -->
    <button id="btnBackToDashboard">‚Üê Back to Dashboard</button>
</div>


            <div class="main-grid">
                <div class="card">
                    <div class="card-header">
                        <h3>üìç Real-Time Campus Map</h3>
                        <div class="card-actions">
                            <button class="icon-btn-small" id="refreshMapBtn" title="Refresh">üîÑ</button>
                            <button class="icon-btn-small" id="fullscreenMapBtn" title="Fullscreen">‚õ∂</button>
                        </div>
                    </div>
                    <div id="map"></div>
                    <div class="map-legend">
                        <h4>Status</h4>
                        <div class="legend-item"><div class="legend-color" style="background: #10b981;"></div><span>Safe (GPS)</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #ef4444;"></div><span>Trapped (GPS)</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #1f2937;"></div><span>Missing (Last Known)</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #f59e0b;"></div><span>RFID Only</span></div>
                    </div>
                </div>

                

                <div>
                    <div class="card sos-card">
                        <div class="sos-banner">
                            <h3>üö® SOS ALERTS (<span id="sosCount">0</span>)</h3>
                            <button class="sos-mute" id="muteSOSBtn">üîï</button>
                        </div>
                        <div class="alerts-list" id="sosList">
                            <div style="padding: 20px; text-align: center; color: #6b7280;">No active alerts</div>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 20px;">
                        <div class="card-header">
                            <h3>üìä Evacuation Analytics</h3>
                        </div>
                        <div style="padding: 20px;" id="analyticsContent"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="settingsPage" class="hidden">
    <h2>‚öôÔ∏è Settings</h2>
    <!-- 1. User Account / Authentication -->
    <section>
        <h3>User Account / Authentication</h3>
        <!-- Sign Up / Login -->
        <button id="btnAddUser">Add New User</button>
        <button id="btnManageUsers">Manage Users</button>
        <div id="userList" style="margin-top: 10px;"></div>
        <!-- Optional: Password Reset -->
        <button id="btnResetPassword">Reset Password</button>
    </section>
    <!-- 2. Device Control -->
    <section>
        <h3>Device Control</h3>
        <div id="deviceList">
            <!-- List of devices with On/Off buttons populated by JS -->
        </div>
    </section>
    <!-- 3. Dashboard Display -->
    <section>
        <h3>Dashboard Display</h3>
        <label><input type="radio" name="dashboardView" value="chart"> Chart</label>
        <label><input type="radio" name="dashboardView" value="numbers"> Numbers</label>
    </section>
    <!-- 4. Alert Settings -->
    <section>
        <h3>Alert Settings</h3>
        <label>High Temperature Threshold: 
            <input type="number" id="highTempLimit" value="50"> ¬∞C
        </label>
        <button id="btnSaveAlertSettings">Save Alert Settings</button>
    </section>
    <!-- 5. User Profile -->
    <section>
        <h3>User Profile</h3>
        <input type="text" id="profileName" placeholder="Name">
        <input type="email" id="profileEmail" placeholder="Email">
        <input type="password" id="profilePassword" placeholder="New Password">
        <button id="btnUpdateProfile">Update Profile</button>
    </section>
    <!-- 6. Theme -->
    <section>
        <h3>Theme</h3>
        <button id="btnLightMode">Light Mode</button>
        <button id="btnDarkMode">Dark Mode</button>
    </section>
    <!-- Back to Dashboard -->
    <button id="btnBackToDashboard">‚Üê Back to Dashboard</button>
</div>

        <div id="studentsPage" class="content hidden">
            <div class="page-header">
                <h2>üë• Student Management</h2>
                <button class="btn btn-primary" id="addStudentBtn">‚ûï Add Student</button>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <input type="text" id="studentSearch" placeholder="üîç Search students..." style="width: 300px; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px;">
                </div>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Class</th>
                                <th>RFID</th>
                                <th>GPS Device</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="devicesPage" class="content hidden">
            <div class="page-header">
                <h2>üì° Device Management (RFID & GPS Tracking)</h2>
                <button class="btn btn-primary" id="registerDeviceBtn">‚ûï Register Device</button>
            </div>

            <div class="stats-row" style="margin-bottom: 24px;">
                <div class="stat-card">
                    <div class="stat-info">
                        <h3>TOTAL DEVICES</h3>
                        <div class="count" id="totalDevices">0</div>
                    </div>
                    <div class="stat-icon">üì±</div>
                </div>
                <div class="stat-card">
                    <div class="stat-info">
                        <h3>ONLINE</h3>
                        <div class="count" id="onlineDevices">0</div>
                    </div>
                    <div class="stat-icon">üü¢</div>
                </div>
                <div class="stat-card">
                    <div class="stat-info">
                        <h3>OFFLINE</h3>
                        <div class="count" id="offlineDevices">0</div>
                    </div>
                    <div class="stat-icon">üî¥</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>Device List</h3>
                </div>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Device ID</th>
                                <th>Type</th>
                                <th>Assigned To</th>
                                <th>Status</th>
                                <th>Battery</th>
                                <th>Last Signal</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="devicesTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="reportsPage" class="content hidden">
            <div class="page-header">
                <h2>üìÑ Reports & Analytics</h2>
            </div>
            
            <div class="filters-card">
                <h3>Report Filters</h3>
                <div class="filters-grid">
                    <div>
                        <label>Status</label>
                        <select id="statusFilter">
                            <option value="all">All Students</option>
                            <option value="safe">Safe Only</option>
                            <option value="trapped">Trapped Only</option>
                            <option value="missing">Missing Only</option>
                        </select>
                    </div>
                    <div>
                        <label>Class</label>
                        <select id="classFilter">
                            <option value="all">All Classes</option>
                        </select>
                    </div>
                    <div>
                        <label>Date Range</label>
                        <input type="date" id="dateFrom">
                    </div>
                    <div>
                        <label>&nbsp;</label>
                        <input type="date" id="dateTo">
                    </div>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 12px;">
                    <button class="btn" style="background: #ef4444; color: white;" id="exportPDF">üìÑ PDF</button>
                    <button class="btn" style="background: #10b981; color: white;" id="exportCSV">üìä CSV</button>
                    <button class="btn" style="background: #3b82f6; color: white;" id="exportExcel">üìó Excel</button>
                    <button class="btn" style="background: #6b7280; color: white;" id="printReport">üñ®Ô∏è Print</button>
                </div>
            </div>

            <div class="card">
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Class</th>
                                <th>Status</th>
                                <th>GPS Coordinates</th>
                                <th>RFID</th>
                                <th>Last Update</th>
                            </tr>
                        </thead>
                        <tbody id="reportTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="historyPage" class="content hidden">
            <div class="page-header">
                <h2>üìú Event History & Activity Log</h2>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>Recent Events</h3>
                </div>
                <div class="timeline" id="eventTimeline"></div>
            </div>
        </div>

       <!-- SETTINGS PAGE -->
<div id="settingsPage" class="hidden">
    <h2>‚öôÔ∏è Settings</h2>
    
    <!-- User Account / Authentication -->
    <section class="settings-section">
        <h3>User Account / Authentication</h3>
        <button id="btnSignUp">Sign Up</button>
        <button id="btnLogin">Login</button>
        <button id="btnPasswordReset">Password Reset</button>
        <label>
            Role: 
            <select id="userRole">
                <option value="admin">Admin</option>
                <option value="user">Regular User</option>
                <option value="guest">Guest</option>
            </select>
        </label>
    </section>
    <!-- Device Control -->
    <section class="settings-section">
        <h3>Device Control</h3>
        <div id="deviceList">
            <button class="device-btn">Device 1 ON</button>
            <button class="device-btn">Device 1 OFF</button>
            <button class="device-btn">Device 2 ON</button>
            <button class="device-btn">Device 2 OFF</button>
        </div>
    </section>
    <!-- Dashboard Display -->
    <section class="settings-section">
        <h3>Dashboard Display</h3>
        <label><input type="radio" name="dashboardView" value="chart"> Chart</label>
        <label><input type="radio" name="dashboardView" value="numbers"> Numbers</label>
    </section>
    <!-- Alert Settings -->
    <section class="settings-section">
        <h3>Alert Settings</h3>
        <label>High Temp Threshold: <input type="number" id="highTempLimit" value="50"> ¬∞C</label>
    </section>
    <!-- User Profile -->
    <section class="settings-section">
        <h3>User Profile</h3>
        <input type="text" id="profileName" placeholder="Name">
        <input type="email" id="profileEmail" placeholder="Email">
        <input type="password" id="profilePassword" placeholder="New Password">
        <button id="btnUpdateProfile">Update Profile</button>
    </section>
    <!-- Theme -->
    <section class="settings-section">
        <h3>Theme</h3>
        <button id="btnLightMode">Light Mode</button>
        <button id="btnDarkMode">Dark Mode</button>
    </section>
    <button id="btnBackToDashboard">‚Üê Back</button>
</div>


                <div class="card">
                    <div class="card-header">
                        <h3>üóÑÔ∏è Data Management</h3>
                    </div>
                    <div class="settings-content">
                        <button class="btn" style="background: #10b981; color: white; width: 100%; margin-bottom: 10px;" id="backupDataBtn">üíæ Backup Data</button>
                        <button class="btn" style="background: #f59e0b; color: white; width: 100%; margin-bottom: 10px;" id="restoreDataBtn">üì• Restore Data</button>
                        <button class="btn" style="background: #ef4444; color: white; width: 100%;" id="clearDataBtn">üóëÔ∏è Clear All Data</button>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<div id="studentModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">Add Student</h3>
            <button class="modal-close" id="closeStudentModal">√ó</button>
        </div>
        <form id="studentForm">
            <div class="form-group">
                <label>Student ID</label>
                <input type="text" id="studentId" required>
            </div>
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="studentName" required>
            </div>
            <div class="form-group">
                <label>Class</label>
                <input type="text" id="studentClass" placeholder="e.g., Grade 10" required>
            </div>
            <div class="form-group">
                <label>Section</label>
                <input type="text" id="studentSection" placeholder="e.g., A" required>
            </div>
            <div class="form-group">
                <label>Contact Number</label>
                <input type="tel" id="studentContact" placeholder="+63 9XX XXX XXXX" required>
            </div>
            <div class="form-group">
                <label>RFID Tag</label>
                <input type="text" id="studentRFID" placeholder="Optional">
            </div>
            <div class="form-group">
                <label>GPS Device ID</label>
                <input type="text" id="studentGPS" placeholder="Optional">
            </div>
            <button type="submit" class="btn btn-primary">Save Student</button>
        </form>
    </div>
</div>

<div id="deviceModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Register Device</h3>
            <button class="modal-close" id="closeDeviceModal">√ó</button>
        </div>
        <form id="deviceForm">
            <div class="form-group">
                <label>Device Type</label>
                <select id="deviceType" required>
                    <option value="rfid">RFID Tag</option>
                    <option value="gps">GPS Tracker</option>
                    <option value="both">GPS + RFID</option>
                </select>
            </div>
            <div class="form-group">
                <label>Device ID</label>
                <input type="text" id="deviceId" required>
            </div>
            <div class="form-group">
                <label>Assign to Student</label>
                <select id="deviceStudent" required>
                    <option value="">Select Student</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Register Device</button>
        </form>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<script src="script.js"></script>

<script type="module">
  // 1. Import necessary Firebase SDKs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAq_BZlzuqRbikcPpuCum_T60oRBZ-Npe8",
    authDomain: "smart-headcount-system.firebaseapp.com",
    // 2. Add the Database URL (Essential for the ESP32 connection)
    databaseURL: "https://smart-headcount-system-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "smart-headcount-system",
    storageBucket: "smart-headcount-system.firebasestorage.app",
    messagingSenderId: "506857684238",
    appId: "1:506857684238:web:6cdb77c30537c1ef32ab5f",
    measurementId: "G-9DJ0BCG62B"
  };

  // 3. Initialize Firebase and Database
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getDatabase(app); 

  // 4. Create reference to your ESP32 device data
  const deviceRef = ref(db, 'devices/DEVICE_01');
  
  // 5. Listen for real-time updates
  onValue(deviceRef, (snapshot) => {
    const data = snapshot.val();
    if (data) {
      console.log("ESP32 Data Received:", data);
      
      // Move the Map Marker if GPS data exists
      if (data.lat && data.lng && window.studentMarker) {
        const newLatLng = [data.lat, data.lng];
        window.studentMarker.setLatLng(newLatLng);
        
        // Optional: Center the map on the student's current position
        // map.panTo(newLatLng); 
      }
      
      // Update the "Last Updated" timestamp on the dashboard
      const timeElement = document.getElementById('lastUpdateTime');
      if(timeElement) {
        timeElement.innerText = new Date().toLocaleTimeString();
      }
    }
  });
</script>

   // 4. Listen for ESP32 Data (Motion & GPS)
  const deviceRef = ref(db, 'devices/DEVICE_01'); // Siguruha nga 'db' ang variable name sa imong getDatabase()
  onValue(deviceRef, (snapshot) => {
    const data = snapshot.val();
    if (data) {
        console.log("ESP32 Data Received:", data);

        // A. UPDATE MOTION SENSOR UI
        const motionBox = document.getElementById('motionStatus');
        if (motionBox) {
            if (data.motion_detected === true || data.motion_detected === 1) {
                motionBox.innerText = "‚ö†Ô∏è WARNING: MOVEMENT DETECTED!";
                motionBox.className = "status-alert-red";
            } else {
                motionBox.innerText = "üõ°Ô∏è SYSTEM SECURE: NO MOTION DETECTED";
                motionBox.className = "status-normal-green";
            }
        }

        // B. UPDATE LAST UPDATE TIME (Imong original logic)
        if (document.getElementById('lastUpdateTime')) {
            document.getElementById('lastUpdateTime').innerText = new Date().toLocaleTimeString();
        }

        // C. UPDATE GPS / RFID DATA
        if (data.rfid_tag && data.rfid_tag !== "None") {
            console.log("RFID Tag Detected: " + data.rfid_tag);
            // Dinhi nimo i-trigger ang imong attendance logic
        }
    }
  });
</script>
</body>
</html>